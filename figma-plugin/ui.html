<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    button { width: 100%; padding: 10px; cursor: pointer; background: #18A0FB; color: white; border: none; border-radius: 4px; }
    #status { margin-top: 10px; font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <h2>JarvisX UI Export</h2>
  <button id="export">Export Selected UI to AI</button>
  <div id="status">Ready</div>

  <script>
    document.getElementById('export').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'export-ui' } }, '*');
      document.getElementById('status').innerText = 'Exporting...';
    };

    window.onmessage = async (event) => {
      const msg = event.data.pluginMessage;
      if (msg.type === 'ui-tree') {
        try {
          const res = await fetch("http://localhost:3333/ui", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(msg.tree)
          });
          document.getElementById('status').innerText = 'Sent to AI Server!';
        } catch (e) {
          document.getElementById('status').innerText = 'Error: AI Server not reachable.';
        }
      }
    };
  </script>
</body>
</html>
